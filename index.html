<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ê²¨ìš¸ë°©í•™ í•™ìŠµ ì²´í¬</title>
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-gradient: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            --main-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Pretendard', sans-serif; background: var(--main-gradient); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 10px; }
        
        #introPage { text-align: center; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100vh; position: fixed; top: 0; left: 0; background: var(--main-gradient); z-index: 1000; transition: 0.5s; }
        .intro-title { font-size: 2.5rem; font-weight: 800; margin-bottom: 10px; }
        .start-btn { padding: 18px 40px; font-size: 1.2rem; font-weight: bold; color: var(--primary-color); background: white; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.1); margin-top: 20px; }

        .container { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); width: 100%; max-width: 500px; display: none; margin: 10px auto; }
        h1 { font-size: 1.2rem; color: var(--primary-color); display: flex; justify-content: center; align-items: center; gap: 10px; margin-bottom: 15px; }
        .nav-button { background: var(--primary-color); color: white; border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        
        .progress-section { background: var(--main-gradient); border-radius: 15px; padding: 20px; color: white; margin-bottom: 20px; }
        .progress-display { display: flex; align-items: center; gap: 10px; }
        .progress-percentage { font-size: 1.8rem; font-weight: bold; min-width: 65px; }
        .progress-bar-container { flex: 1; height: 12px; background: rgba(255,255,255,0.2); border-radius: 10px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--success-gradient); transition: width 0.6s ease; }
        
        .subjects { display: flex; flex-direction: column; gap: 10px; }
        .subject-item { background: #f8f9fa; border-radius: 12px; padding: 15px; border: 1px solid #eee; transition: 0.3s; }
        .subject-item.checked { background: #f0fdf4; border-color: #bdf3d4; }
        .subject-header { display: flex; align-items: center; gap: 8px; }
        .subject-name-input { border: none; background: transparent; font-weight: 600; font-size: 1rem; flex-grow: 1; outline: none; }
        
        /* [ìˆ˜ì •ëœ ë¶€ë¶„] ì•„ì´í° ì„¸ë¡œëª¨ë“œ ì°Œê·¸ëŸ¬ì§ ë°©ì§€ */
        .icon-btn { 
            background: white; 
            border: 1px solid #e2e8f0; 
            width: 28px !important; 
            height: 28px !important; 
            min-width: 28px; /* ë„ˆë¹„ ê³ ì • */
            min-height: 28px; /* ë†’ì´ ê³ ì • */
            flex-shrink: 0; /* flex í™˜ê²½ì—ì„œ ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ ì„¤ì • */
            border-radius: 50%; 
            cursor: pointer; 
            color: #718096; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 0.7rem; 
            transition: 0.2s; 
            padding: 0; /* íŒ¨ë”© ì´ˆê¸°í™”ë¡œ ì›í˜• ìœ ì§€ */
        }
        .icon-btn:hover { background: #f7fafc; color: var(--primary-color); }
        .del-btn { color: #f56565; border-color: #fed7d7; }

        .detail-list { display: none; margin-top: 10px; padding-left: 5px; border-top: 1px dashed #eee; padding-top: 10px; }
        .detail-list.expanded { display: block; }
        .detail-item { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
        .detail-item input[type="text"] { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.9rem; }
        .detail-item.checked input[type="text"] { text-decoration: line-through; opacity: 0.5; }

        .btn-action { width: 100%; padding: 14px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .save-button { background: var(--primary-color); color: white; }
        .add-btn { background: #f8f9fa; border: 1px dashed #ccc; color: #666; font-size: 0.85rem; }
        
        .header-title-input { border: none; background: transparent; text-align: center; color: #666; font-size: 0.9rem; width: 100%; outline: none; }
        .calendar-day { aspect-ratio: 1; border: 1px solid #f0f0f0; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 0.8rem; cursor: pointer; background: white; }
        .calendar-day.has-data { background: #ebf8ff; font-weight: bold; border-color: #bee3f8; }
        .cal-p { font-size: 0.65rem; color: var(--primary-color); margin-top: 2px; }
    </style>
</head>
<body>

    <div id="introPage">
        <div class="intro-title">Winter Study â„ï¸</div>
        <p>ê¸°ë¡í•˜ëŠ” ê²¨ìš¸ë°©í•™, ì„±ì¥í•˜ëŠ” ë‹¹ì‹ </p>
        <button class="start-btn" onclick="startApp()">ì‹œì‘í•˜ê¸°</button>
    </div>

    <div class="container" id="mainContainer">
        <div id="dailyView">
            <button class="btn-action" style="background:#f0f2f5; color:#4a5568; margin-bottom:15px;" onclick="toggleView()">ğŸ“… ì›”ë³„ í˜„í™© ë³´ê¸°</button>
            <h1>
                <button class="nav-button" onclick="changeDate(-1)">â—€</button>
                <span id="displayDateText"></span>
                <button class="nav-button" onclick="changeDate(1)">â–¶</button>
            </h1>
            <div id="currentDateDetail" style="text-align:center; margin-bottom:15px;"></div>
            
            <div class="progress-section">
                <div class="progress-display">
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="progressBarFill" style="width: 0%"></div>
                    </div>
                </div>
                <div style="text-align:center; font-size:0.8rem; margin-top:8px; opacity:0.9;" id="progressText">0/0 ì™„ë£Œ</div>
            </div>

            <div class="subjects" id="subjectsList"></div>
            <button class="btn-action add-btn" onclick="addNewSubject()">+ ê³¼ëª© ì¶”ê°€ (ìµœëŒ€ 10ê°œ)</button>
            <button class="btn-action save-button" onclick="saveAllData()">ğŸ’¾ ì§€ê¸ˆ ë‚´ìš© ì €ì¥í•˜ê¸°</button>
            <button class="btn-action" style="background:#fff5f5; color:#f56565; font-size:0.8rem;" onclick="resetAll()">ğŸ”„ ì´ ë‚ ì§œ ì´ˆê¸°í™”</button>
        </div>

        <div id="calendarView" style="display:none;">
            <button class="btn-action" style="background:#f0f2f5; color:#4a5568; margin-bottom:15px;" onclick="toggleView()">ğŸ“ ì¼ë³„ ë³´ê¸°</button>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 id="calendarTitle" style="font-size:1.1rem; color:var(--primary-color);"></h2>
                <div style="display:flex; gap:8px;">
                    <button class="nav-button" onclick="changeCalendarMonth(-1)">â—€</button>
                    <button class="nav-button" onclick="changeCalendarMonth(1)">â–¶</button>
                </div>
            </div>
            <div id="calendarGrid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px;"></div>
        </div>
    </div>

    <script>
        let currentDisplayDate = new Date();
        let currentCalendarDate = new Date();
        let isResetting = false;
        let currentSubjects = [];

        function startApp() {
            document.getElementById('introPage').style.display = 'none';
            document.getElementById('mainContainer').style.display = 'block';
            init();
        }

        function init() { displayDate(); loadAllData(); }

        function getStorageKey(dateObj = currentDisplayDate) { 
            return `ws_v7_${dateObj.getFullYear()}_${dateObj.getMonth()+1}_${dateObj.getDate()}`; 
        }

        function renderSubjects() {
            const container = document.getElementById('subjectsList');
            container.innerHTML = currentSubjects.map(s => `
                <div class="subject-item" id="${s.id}-item">
                    <div class="subject-header">
                        <input type="checkbox" id="${s.id}" onchange="updateProgress()">
                        <input type="text" class="subject-name-input" id="${s.id}-name" value="${s.name}" onchange="saveSubjectName('${s.id}')">
                        <div style="font-size:0.8rem; font-weight:bold; color:var(--primary-color); margin-right:5px;" id="${s.id}-progress">0%</div>
                        <button class="icon-btn" onclick="toggleDetails('${s.id}')">â–¼</button>
                        <button class="icon-btn del-btn" onclick="deleteSubject('${s.id}')">âœ•</button>
                    </div>
                    <div class="detail-list" id="${s.id}-details">
                        <div id="${s.id}-detail-items"></div>
                        <button class="add-btn btn-action" style="padding:8px; font-size:0.7rem;" onclick="addDetailItem('${s.id}')">+ ì„¸ë¶€ í•­ëª© ì¶”ê°€</button>
                    </div>
                </div>
            `).join('');
        }

        function addNewSubject() {
            if(currentSubjects.length >= 10) return alert('ìµœëŒ€ 10ê°œê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
            tempSaveAll();
            currentSubjects.push({ id: 'sub_' + Date.now(), name: 'ìƒˆ ê³¼ëª©' });
            saveCurrentSubjectList();
            loadAllData();
        }

        function deleteSubject(sid) {
            if(confirm('ì´ ê³¼ëª©ì„ ì‚­ì œí• ê¹Œìš”?')) {
                currentSubjects = currentSubjects.filter(s => s.id !== sid);
                saveCurrentSubjectList();
                loadAllData();
            }
        }

        function addDetailItem(sid) {
            const area = document.getElementById(`${sid}-detail-items`);
            const div = document.createElement('div');
            div.className = 'detail-item';
            div.innerHTML = `<input type="checkbox" onchange="updateSubjectProgress('${sid}')"><input type="text" placeholder="í•  ì¼..." onchange="saveDetailState('${sid}')"><button class="icon-btn del-btn" style="width:20px; height:20px; font-size:0.5rem;" onclick="this.parentElement.remove(); updateSubjectProgress('${sid}');">âœ•</button>`;
            area.appendChild(div);
            updateSubjectProgress(sid);
        }

        function updateSubjectProgress(sid) {
            if(isResetting) return;
            const area = document.getElementById(`${sid}-detail-items`);
            if(!area) return;
            const items = area.querySelectorAll('.detail-item');
            const checked = Array.from(items).filter(it => it.querySelector('input[type="checkbox"]').checked).length;
            const p = items.length > 0 ? Math.round((checked / items.length) * 100) : 0;
            document.getElementById(`${sid}-progress`).textContent = p + '%';
            document.getElementById(sid).checked = (items.length > 0 && checked === items.length);
            items.forEach(it => it.classList.toggle('checked', it.querySelector('input[type="checkbox"]').checked));
            updateProgress();
            saveDetailState(sid);
        }

        function updateProgress() {
            if(isResetting) return;
            let done = 0;
            currentSubjects.forEach(s => {
                const cb = document.getElementById(s.id);
                if(cb && cb.checked) done++;
                document.getElementById(`${s.id}-item`)?.classList.toggle('checked', cb?.checked);
            });
            const p = currentSubjects.length > 0 ? Math.round((done / currentSubjects.length) * 100) : 0;
            document.getElementById('progressPercentage').textContent = p + '%';
            document.getElementById('progressBarFill').style.width = p + '%';
            document.getElementById('progressText').textContent = `${done}/${currentSubjects.length} ì™„ë£Œ`;
            
            const state = {};
            currentSubjects.forEach(s => state[s.id] = document.getElementById(s.id)?.checked || false);
            localStorage.setItem(getStorageKey(), JSON.stringify(state));
        }

        function loadAllData() {
            isResetting = true;
            const key = getStorageKey();
            const savedSubs = JSON.parse(localStorage.getItem(`${key}_list`) || '[]');
            currentSubjects = savedSubs.length > 0 ? savedSubs : [{id:'s1', name:'ê¸°ë³¸ ê³¼ëª©'}];
            renderSubjects();

            const main = JSON.parse(localStorage.getItem(key) || '{}');
            document.getElementById('currentDateDetail').innerHTML = `<input type="text" class="header-title-input" value="${localStorage.getItem(`${key}_title`) || '2026ë…„ ê²¨ìš¸ë°©í•™'}" onchange="localStorage.setItem('${key}_title', this.value)">`;

            currentSubjects.forEach(s => {
                const cb = document.getElementById(s.id);
                if(cb) cb.checked = !!main[s.id];
                document.getElementById(`${s.id}-name`).value = localStorage.getItem(`${key}_${s.id}_name`) || s.name;
                
                const dets = JSON.parse(localStorage.getItem(`${key}_${s.id}_details`) || '[]');
                const area = document.getElementById(`${s.id}-detail-items`);
                area.innerHTML = '';
                dets.forEach(d => {
                    const div = document.createElement('div');
                    div.className = 'detail-item ' + (d.checked ? 'checked' : '');
                    div.innerHTML = `<input type="checkbox" ${d.checked?'checked':''} onchange="updateSubjectProgress('${s.id}')"><input type="text" value="${d.text||''}" onchange="saveDetailState('${s.id}')"><button class="icon-btn del-btn" style="width:20px; height:20px; font-size:0.5rem;" onclick="this.parentElement.remove(); updateSubjectProgress('${s.id}');">âœ•</button>`;
                    area.appendChild(div);
                });
                if(dets.length === 0) addDetailItem(s.id);

                const items = area.querySelectorAll('.detail-item');
                const ck = Array.from(items).filter(it => it.querySelector('input[type="checkbox"]').checked).length;
                const p = items.length > 0 ? Math.round((ck / items.length) * 100) : 0;
                document.getElementById(`${s.id}-progress`).textContent = p + '%';
            });
            isResetting = false;
            updateProgress();
        }

        function saveSubjectName(sid) { localStorage.setItem(`${getStorageKey()}_${sid}_name`, document.getElementById(`${sid}-name`).value); }
        function saveDetailState(sid) {
            if(isResetting) return;
            const area = document.getElementById(`${sid}-detail-items`);
            if(!area) return;
            const data = Array.from(area.querySelectorAll('.detail-item')).map(it => ({
                checked: it.querySelector('input[type="checkbox"]').checked,
                text: it.querySelector('input[type="text"]').value
            }));
            localStorage.setItem(`${getStorageKey()}_sid_${sid}_details`, JSON.stringify(data));
            localStorage.setItem(`${getStorageKey()}_${sid}_details`, JSON.stringify(data));
        }
        function saveCurrentSubjectList() { localStorage.setItem(`${getStorageKey()}_list`, JSON.stringify(currentSubjects)); }
        
        function tempSaveAll() {
            currentSubjects.forEach(s => { saveSubjectName(s.id); saveDetailState(s.id); });
            saveCurrentSubjectList();
            updateProgress();
        }

        function saveAllData() { tempSaveAll(); alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! âœ¨'); }

        function resetAll() {
            if(confirm('ì´ ë‚ ì§œì˜ ëª¨ë“  ê¸°ë¡ì„ ì´ˆê¸°í™”í• ê¹Œìš”?')) {
                const key = getStorageKey();
                localStorage.removeItem(key);
                currentSubjects.forEach(s => {
                    localStorage.removeItem(`${key}_${s.id}_details`);
                    localStorage.removeItem(`${key}_sid_${s.id}_details`);
                });
                loadAllData();
            }
        }

        function changeDate(v) { 
            tempSaveAll();
            currentDisplayDate.setDate(currentDisplayDate.getDate() + v); 
            init(); 
        }

        function displayDate() { const days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† ']; document.getElementById('displayDateText').textContent = `${currentDisplayDate.getMonth()+1}ì›” ${currentDisplayDate.getDate()}ì¼ (${days[currentDisplayDate.getDay()]})`; }
        
        function toggleView() {
            const dv = document.getElementById('dailyView'), cv = document.getElementById('calendarView');
            if(dv.style.display === 'none') { dv.style.display = 'block'; cv.style.display = 'none'; loadAllData(); } 
            else { dv.style.display = 'none'; cv.style.display = 'block'; renderCalendar(); }
        }

        function renderCalendar() {
            const year = currentCalendarDate.getFullYear(), month = currentCalendarDate.getMonth();
            document.getElementById('calendarTitle').textContent = `${year}ë…„ ${month + 1}ì›”`;
            const firstDay = new Date(year, month, 1).getDay(), lastDate = new Date(year, month + 1, 0).getDate();
            const grid = document.getElementById('calendarGrid'); grid.innerHTML = '';
            ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d => grid.innerHTML += `<div style="text-align:center; font-weight:bold; color:#a0aec0; padding:5px; font-size:0.7rem;">${d}</div>`);
            for (let i = 0; i < firstDay; i++) grid.innerHTML += `<div></div>`;
            for (let d = 1; d <= lastDate; d++) {
                const key = `ws_v7_${year}_${month+1}_${d}`;
                const saved = JSON.parse(localStorage.getItem(key) || '{}');
                const subs = JSON.parse(localStorage.getItem(`${key}_list`) || '[]');
                const done = Object.values(saved).filter(v => v === true).length;
                const p = subs.length > 0 ? Math.round((done / subs.length) * 100) : 0;
                grid.innerHTML += `<div class="calendar-day ${p>0?'has-data':''}" onclick="currentDisplayDate=new Date(${year},${month},${d});toggleView()">
                    ${d}${p>0?`<span class="cal-p">${p}%</span>`:''}
                </div>`;
            }
        }
        function changeCalendarMonth(v) { currentCalendarDate.setMonth(currentCalendarDate.getMonth() + v); renderCalendar(); }
        function toggleDetails(sid) { document.getElementById(`${sid}-details`).classList.toggle('expanded'); }
        window.onload = () => { /* ìë™ì‹œì‘ ëŒ€ê¸° */ };
    </script>
</body>
</html>